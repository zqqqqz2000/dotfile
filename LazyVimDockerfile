FROM debian:bookworm

RUN apt-get update -y && apt-get install -y sudo curl zsh git gcc

RUN curl -LO https://github.com/neovim/neovim/releases/latest/download/nvim-linux64.tar.gz && \
	rm -rf /opt/nvim && \
	tar -C /opt -xzf nvim-linux64.tar.gz && \
	rm nvim-linux64.tar.gz

ENV PATH="$PATH:/opt/nvim-linux64/bin"

# add user
RUN useradd -ms /usr/bin/zsh dev && \
	usermod -aG sudo dev && \
	echo "dev ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers

USER dev

RUN sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" && sudo chsh -s $(which zsh)

# config neovim
RUN git clone https://github.com/LazyVim/starter ~/.config/nvim && \
	rm -rf ~/.config/nvim/.git && \
	nvim --headless -c 'Lazy sync' +q

# ADD .config 
WORKDIR /home/dev
ENTRYPOINT nvim
